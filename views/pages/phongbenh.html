<!DOCTYPE html>
<html lang="zxx">
<head>
	{%include "common/css.html"%}
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="js">
	<!-- Header -->
	{%include "common/header.html"%}
	<!--/ End Header -->
	
	<!-- Start Product Area -->
	<div class="container mt-5">	
		<div class="row mb-0">
			<div class="col-6 border border-dark p-3">
				<div class="row justify-content-center">
					<h5>Phòng số 1</h5>
				</div>
				<div class="row mt-2 ">
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn" id="1.1"><a href="/benhnhan">Giường 1</a></div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 2</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 3</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 4</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 5</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn1">Giường 6</div>
					</div>
				</div>
			</div>
			<div class="col-6 border border-dark p-3">
				<div class="row justify-content-center">
					<h5>Phòng số 2</h5>
				</div>
				<div class="row mt-2 ">
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn1">Giường 1</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 2</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 3</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn1">Giường 4</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 5</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 6</div>
					</div>
				</div>
			</div>
			<div class="col-6 border border-dark p-3">
				<div class="row justify-content-center">
					<h5>Phòng số 3</h5>
				</div>
				<div class="row mt-2 ">
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 1</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 2</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 3</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 4</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 5</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 6</div>
					</div>
				</div>
			</div>
			<div class="col-6 border border-dark p-3">
				<div class="row justify-content-center">
					<h5>Phòng số 4</h5>
				</div>
				<div class="row mt-2 ">
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 1</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 2</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 3</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 4</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 5</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 6</div>
					</div>
				</div>
			</div>
			<div class="col-6 border border-dark p-3">
				<div class="row justify-content-center">
					<h5>Phòng số 5</h5>
				</div>
				<div class="row mt-2 ">
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 1</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn1">Giường 2</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 3</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 4</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 5</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 6</div>
					</div>
				</div>
			</div>
			<div class="col-6 border border-dark p-3">
				<div class="row justify-content-center">
					<h5>Phòng số 6</h5>
				</div>
				<div class="row mt-2 ">
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 1</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 2</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 3</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 4</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 5</div>
					</div>
					<div class="col-2 col-lg-4 mt-1 mb-1">
						<div class="btn">Giường 6</div>
					</div>
				</div>
			</div>
		</div>
	</div>	
	<!-- Modal -->
    <!-- Modal end -->
	<script>
		// Khởi tạo WebSocket
		const ws = new WebSocket('ws://localhost:2222');
	
		let lastUpdateTime = Date.now(); // Thời gian nhận dữ liệu cuối cùng
		const TIMEOUT_MS = 5000; // Thời gian timeout (5 giây)
	
		// Phần tử "Giường 1 Phòng 1"
		const bedElement = document.getElementById("1.1");
	
		// Hàm đặt màu giường về đen khi không có dữ liệu
		const resetBedColor = () => {
			if (bedElement) {
				bedElement.style.backgroundColor = "black";
				bedElement.style.color = "white";
			}
		};
	
		// Cập nhật dữ liệu khi nhận được từ WebSocket
		ws.onmessage = (event) => {
			const data = JSON.parse(event.data);
	
			// Cập nhật thời gian nhận dữ liệu cuối cùng
			lastUpdateTime = Date.now();
	
			// Kiểm tra và thay đổi màu sắc giường
			if (data.heartRate < 60 || (data.heartRate > 100 && data.spo2 < 94)) {
				// Màu đỏ nếu không đạt yêu cầu
				if (bedElement) {
					bedElement.style.backgroundColor = "red";
					bedElement.style.color = "white";
				}
			} else {
				// Màu xanh nếu đạt yêu cầu
				if (bedElement) {
					bedElement.style.backgroundColor = "green";
					bedElement.style.color = "white";
				}
			}
		};
	
		// Kiểm tra trạng thái timeout (không nhận dữ liệu trong khoảng thời gian nhất định)
		setInterval(() => {
			const currentTime = Date.now();
			if (currentTime - lastUpdateTime > TIMEOUT_MS) {
				resetBedColor(); // Đặt lại màu đen nếu timeout
			}
		}, 1000); // Kiểm tra mỗi giây
	
		// Xử lý lỗi WebSocket
		ws.onerror = (error) => {
			console.error("WebSocket error:", error);
		};
	
		// Đóng kết nối WebSocket
		ws.onclose = () => {
			console.log("WebSocket connection closed.");
			resetBedColor(); // Đặt lại màu đen nếu mất kết nối
		};
	</script>
	
	{%include "common/js.html"%}
	<!-- Jquery -->
    
</body>
</html>





